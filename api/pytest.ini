[pytest]
# Pytest configuration for Bifrost API
pythonpath = .
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Per-test timeout (catches infinite hangs; generous for e2e)
timeout = 120
timeout_method = thread

# Output options
addopts = -v --tb=short --strict-markers --junitxml=/tmp/bifrost/test-results.xml

# Custom markers for organizing tests
markers =
    unit: Unit tests (fast, no Docker required)
    e2e: End-to-end tests (Docker stack with database, message queue, and services)
    slow: Tests that take >1 second

# Warnings
filterwarnings =
    ignore::DeprecationWarning:pydantic.*
    # Suppress SQLAlchemy async warnings
    ignore:Pydantic serializer warnings:UserWarning
    # Suppress httpx warnings
    ignore::pytest.PytestUnraisableExceptionWarning
    # Suppress asyncpg connection cleanup warnings during test teardown
    # These occur when async connections aren't fully awaited during cleanup
    # This is a known asyncpg/SQLAlchemy async limitation, not a code bug
    ignore:coroutine 'Connection._cancel' was never awaited:RuntimeWarning
