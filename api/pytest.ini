[pytest]
# Pytest configuration for Bifrost API
pythonpath = .
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Output options
# By default, exclude e2e tests (run with -m e2e to include them)
addopts = -v --tb=short --strict-markers -m "not e2e"

# Custom markers for organizing tests
markers =
    unit: Unit tests (fast, mocked dependencies)
    integration: Integration tests (real database, message queue)
    e2e: End-to-end tests (full API stack with all services)
    slow: Tests that take >1 second

# Warnings
filterwarnings =
    ignore::DeprecationWarning:pydantic.*
    # Suppress SQLAlchemy async warnings
    ignore:Pydantic serializer warnings:UserWarning
    # Suppress httpx warnings
    ignore::pytest.PytestUnraisableExceptionWarning
    # Suppress asyncpg connection cleanup warnings during test teardown
    # These occur when async connections aren't fully awaited during cleanup
    # This is a known asyncpg/SQLAlchemy async limitation, not a code bug
    ignore:coroutine 'Connection._cancel' was never awaited:RuntimeWarning
